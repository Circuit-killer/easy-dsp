<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Microphones live control</title>
    <link rel="stylesheet" href="vendors/bootstrap.min.css">
    <link rel="stylesheet" href="client.css">
  </head>
  <body>
    <div class="container-fluid">
      <!-- <br />
      <h2 class="text-xs-center">
        Microphones control interface
      </h2>
      <br /> -->
      <div class="row">
        <div class="col-md-3">
          <div class="card">
            <div class="card-header">
              Status
            </div>
            <ul class="list-group list-group-flush">
              <li class="list-group-item">
                <span class="tag tag-default tag-pill float-xs-right tag-danger" id="info-status-code">Disconnected</span>
                Code server
              </li>
              <li class="list-group-item">
                <span class="tag tag-default tag-pill float-xs-right tag-danger" id="info-status-audio">Disconnected</span>
                Audio stream
              </li>
              <li class="list-group-item">
                <span class="tag tag-default tag-pill float-xs-right tag-danger" id="info-status-control">Disconnected</span>
                Control stream
              </li>
              <li class="list-group-item">
                <span class="tag tag-default tag-pill float-xs-right" id="info-audio-latency">-</span>
                Latency
              </li>
              <li class="list-group-item">
                <span class="tag tag-default tag-pill float-xs-right" id="info-rate">-</span>
                Rate
              </li>
              <li class="list-group-item">
                <span class="tag tag-default tag-pill float-xs-right" id="info-channels">-</span>
                Channels
              </li>
              <li class="list-group-item">
                <span class="tag tag-default tag-pill float-xs-right" id="info-frames">-</span>
                Buffer frames
              </li>
              <li class="list-group-item">
                <span class="tag tag-default tag-pill float-xs-right" id="info-volume">-</span>
                Volume
              </li>
            </ul>
          </div>
          <div class="card">
            <div class="card-header">
              Input
            </div>
            <div class="card-block">
              <div class="btn-group" style="display: block;">
                <a id="btn-audio-input-play" class="btn btn-outline-primary col-xs-6">Play</a>
                <a id="btn-audio-input-stop" class="btn btn-outline-danger col-xs-6">Stop</a>
              </div>
              <br /><br />
              <button id="btn-recording" class="btn btn-danger btn-block">
                <span class="text">Record</span>
                <span class="time" style="font-family: Courier"></span>
              </button>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              Change configuration
            </div>
            <div class="card-block">
              <div class="form-group row">
                <label class="col-xs-5 col-form-label">Rate</label>
                <div class="col-xs-7">
                  <select class="form-control" id="config-rate">
                    <option value="22050">22,050 Hz</option>
                    <option value="44100">44,100 Hz</option>
                    <option value="88200">88,200 Hz</option>
                    <option value="176400">176,400 Hz</option>
                  </select>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-xs-5 col-form-label">Channels</label>
                <div class="col-xs-7">
                  <select class="form-control" id="config-channels">
                    <option value="2">2</option>
                    <option value="4">4</option>
                    <option value="6">6</option>
                  </select>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-xs-5 col-form-label">Buffer frames</label>
                <div class="col-xs-7">
                  <input type="number" min="1" step=="1" class="form-control" value="3000" id="config-buffer">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-xs-5 col-form-label">Volume</label>
                <div class="col-xs-7">
                  <input type="range" min="0" step=="100" class="form-control" value="50" id="config-volume">
                </div>
              </div>
              <div class="form-group row">
                <div class="col-xs-12">
                  <input type="button" class="btn btn-primary btn-block" value="Submit" id="config-change">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-9" id="main-stream">
          <div class="card" id="card-external-script">
            <div class="card-main text-xs-center">
              <br />
              The browser is currently receiving data from an external script, so the editor and the console have been temporary disabled.
              <br /><br />
              <button type="button" class="btn btn-outline-warning btn-lg" id="btn-external-script-stop">
                Stop and go back to the editor
              </button>
              <br /><br />
            </div>
          </div>
          <div class="card" id="card-editor">
            <div class="card-header">
              Editor
            </div>
            <div class="card-main" style="padding: 20px; border-bottom: 1px solid lightgray;">
              <div class="row">
                <div class="col-sm-4 col-lg-4">
                  <div class="btn-group" role="group" aria-label="Basic example">
                    <button type="button" class="btn btn-secondary" id="btn-code-start">Execute (âŒ˜+E)</button>
                    <button type="button" class="btn btn-secondary" id="btn-code-stop" disabled="disabled">Stop</button>
                  </div>
                </div>
                <div class="col-sm-4 col-lg-9">
                  <div class="sk-fading-circle" id="animation-running">
                    <div class="sk-circle1 sk-circle"></div>
                    <div class="sk-circle2 sk-circle"></div>
                    <div class="sk-circle3 sk-circle"></div>
                    <div class="sk-circle4 sk-circle"></div>
                    <div class="sk-circle5 sk-circle"></div>
                    <div class="sk-circle6 sk-circle"></div>
                    <div class="sk-circle7 sk-circle"></div>
                    <div class="sk-circle8 sk-circle"></div>
                    <div class="sk-circle9 sk-circle"></div>
                    <div class="sk-circle10 sk-circle"></div>
                    <div class="sk-circle11 sk-circle"></div>
                    <div class="sk-circle12 sk-circle"></div>
                  </div>
                </div>
              </div>
            </div>
<div class="card-main" id="editor"># handleData is called everytime a new buffer is received
# You can call sendAudio with a new buffer to send it to the browser
# A buffer is an array of signed integers, between -32 767 and +32 767

import browserinterface
import time
import random

def handle(buffer):
    print "Buffer", len(buffer)
    i = 0
    for v in buffer:
        buffer[i] = v*20
        i += 1
    # send_audio(buffer)

browserinterface.register_handle_data(handle)
browserinterface.start()

print "Hello World!"

c1 = browserinterface.add_handler("First chart", 'base:graph:line', {'xName': 'ok', 'series': ['yNom', 'ynom 22']})
# c2 = browserinterface.add_handler("Second chart", 'base:graph:plot', {'xName': 'youpi', 'series': ['yNom']})
c3 = browserinterface.add_handler("Custom thing", 'customtype', {'param1': True, 'param2': 'hello'})
c4 = browserinterface.add_handler("Polar", 'base:polar:area', {'title': 'Direction', 'series': ['Intensity'], 'legend': {'from': 0, 'to': 360, 'step': 10}})

c1.send_data([{'x': 1, 'y': 89}, {'x': 1, 'y': 39}])
c1.send_data([{'x': 2, 'y': 70}, {'x': 2, 'y': 20}])
c1.send_data([{'x': 3, 'y': 40}, {'x': 3, 'y': -2}])
c1.send_data([{'x': 4, 'y': 2}, {'x': 4, 'y': 4}])
# c2.send_data([{'x': -4, 'y': 3}])

for i in range(5, 40):
  c1.send_data([{'x': i, 'y': 20+i*5*random.random()}, {'x': i, 'y': i*5*random.random()}])
  c3.send_data({'newData': {'i': i}})
  c4.send_data([{'append': (200+i*3)*10}])
  print i
  time.sleep(1)

# This call is blocking and will never return
# So the code you put below will never be executed
# It's an infinite loop inside which your callbacks will be called
browserinterface.loop_callbacks()

</div>
          </div>
          <div class="card">
            <div class="card-header">
              Output analyse
            </div>
            <div class="card-main">
              <ul class="nav nav-tabs" id="output-tabs" role="tablist">
                <li class="nav-item">
                  <a class="nav-link active" id="output-tab-audio" href="#output-pane-audio" role="tab">Audio</a>
                </li>
              </ul>
              <div class="tab-content" id="output-panes">
                <div class="tab-pane active" id="output-pane-audio" role="tabpanel">
                  <ul>
                    <li>Output: <a id="btn-audio-output-play">Play</a> <a id="btn-audio-output-stop">Stop</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="card" id="card-console">
            <div class="card-header">
              Console<span id="output-return-code"></span>
            </div>
            <div class="card-main">
              <pre><code id="console"></code></pre>
            </div>
          </div>
          <div id="alerts">
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" charset="utf-8" src="vendors/jquery.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="vendors/ace/ace.js"></script>
    <script type="text/javascript" charset="utf-8" src="vendors/ace/mode-python.js"></script>
    <script type="text/javascript" charset="utf-8" src="vendors/keymaster.js"></script>
    <script type="text/javascript" charset="utf-8" src="vendors/lodash.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="vendors/d3.v3.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="vendors/rickshaw/d3.layout.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="vendors/rickshaw/rickshaw.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="vendors/recorder.js"></script>
    <script type="text/javascript" charset="utf-8" src="vendors/micropolar-v0.2.2.js"></script>
    <script type="text/javascript" charset="utf-8" src="vendors/bootstrap.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="vendors/simpleheat.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/dataHandlers.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/myHandlers.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/main.js"></script>
    <link rel="stylesheet" href="vendors/rickshaw/rickshaw.min.css">
  </body>
</html>
